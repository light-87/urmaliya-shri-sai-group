// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

// ============================================
// AUTHENTICATION
// ============================================

model Pin {
  id        String   @id @default(cuid())
  pinNumber String   @unique // 4-digit PIN
  role      PinRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([pinNumber])
}

enum PinRole {
  ADMIN             // PIN 1: Full access
  EXPENSE_INVENTORY // PIN 2: Expenses + Inventory
  INVENTORY_ONLY    // PIN 3: Inventory only
}

// ============================================
// INVENTORY MODULE
// ============================================

model InventoryTransaction {
  id           String     @id @default(cuid())
  date         DateTime
  warehouse    Warehouse
  bucketType   BucketType
  action       ActionType
  quantity     Int        // Signed: negative for Sell, positive for Stock
  buyerSeller  String
  runningTotal Int
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@index([date])
  @@index([warehouse])
  @@index([bucketType])
  @@index([buyerSeller])
}

enum Warehouse {
  PALLAVI
  TULARAM
  FACTORY
}

enum BucketType {
  TATA_G
  TATA_W
  TATA_HP
  AL_10_LTR
  AL
  BB
  ES
  MH
  MH_10_LTR
  TATA_10_LTR
  IBC_TANK
  AP_BLUE
  INDIAN_OIL_20L
  FREE_DEF
}

enum ActionType {
  STOCK
  SELL
}

// ============================================
// STOCK TRACKING MODULE
// ============================================

model StockTransaction {
  id              String               @id @default(cuid())
  date            DateTime
  type            StockTransactionType
  category        StockCategory
  quantity        Float                // Can be negative for consumption
  unit            StockUnit
  description     String?
  runningTotal    Float
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([date])
  @@index([type])
  @@index([category])
}

enum StockTransactionType {
  ADD_UREA       // Adding raw material
  PRODUCE_BATCH  // Production: Urea â†’ Free DEF
  SELL_FREE_DEF  // Selling loose DEF
  FILL_BUCKETS   // Auto: when STOCK bucket in inventory
  SELL_BUCKETS   // Auto: when SELL bucket in inventory
}

enum StockCategory {
  UREA           // Raw material
  FREE_DEF       // Finished goods (loose)
  FINISHED_GOODS // Total finished (Free DEF + Buckets)
}

enum StockUnit {
  KG
  LITERS
  BAGS
}

// ============================================
// EXPENSE MODULE
// ============================================

model ExpenseTransaction {
  id        String          @id @default(cuid())
  date      DateTime
  amount    Decimal         @db.Decimal(12, 2) // Up to 99,99,99,999.99
  account   ExpenseAccount
  type      TransactionType
  name      String          // Vendor/Customer name
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@index([date])
  @@index([account])
  @@index([type])
  @@index([name])
}

enum ExpenseAccount {
  CASH
  PRASHANT_GAYDHANE
  PMR
  KPG_SAVING
  KP_ENTERPRISES
}

enum TransactionType {
  INCOME
  EXPENSE
}

// ============================================
// BACKUP LOGS
// ============================================

model BackupLog {
  id             String   @id @default(cuid())
  backupDate     DateTime @default(now())
  backupType     String   // "MANUAL" or "AUTOMATIC"
  driveFileId    String?  // Google Drive file ID
  inventoryCount Int
  expenseCount   Int
  stockCount     Int      @default(0)
  leadsCount     Int      @default(0)
  status         String   // "SUCCESS" or "FAILED"
  errorMessage   String?

  @@index([backupDate])
}

// ============================================
// SYSTEM SETTINGS
// ============================================

model SystemSettings {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  updatedAt DateTime @updatedAt
}

// ============================================
// LEADS MODULE
// ============================================

model Lead {
  id               String       @id @default(cuid())

  // Basic Info (minimal typing)
  name             String
  phone            String
  company          String?      // Optional

  // Status Tracking (all dropdowns!)
  status           LeadStatus   @default(NEW)
  priority         Priority     @default(MEDIUM)

  // Call Tracking (auto dates + dropdowns)
  lastCallDate     DateTime?    // Auto-filled when status changes
  nextFollowUpDate DateTime?    // Date picker
  callOutcome      CallOutcome? // Dropdown of what happened

  // Notes (predefined options + optional free text)
  quickNote        String?      // Dropdown selection
  additionalNotes  String?      // Optional typing for extra details

  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt

  @@index([status])
  @@index([priority])
  @@index([nextFollowUpDate])
  @@index([lastCallDate])
}

enum LeadStatus {
  NEW              // Just added
  NEED_TO_CALL     // Ready to call
  CALLED           // Called today
  GOT_RESPONSE     // They responded!
  ON_HOLD          // Waiting/paused
  CALL_IN_7_DAYS   // Schedule for next week
  CONVERTED        // Success - became customer
  NOT_INTERESTED   // Dead lead
}

enum Priority {
  LOW      // Green
  MEDIUM   // Yellow
  HIGH     // Orange
  URGENT   // Red
}

enum CallOutcome {
  NO_ANSWER           // Didn't pick up
  BUSY                // Said they're busy
  INTERESTED          // Wants to know more
  NEED_INFO           // Asked for details
  CALL_BACK_LATER     // Said call again
  WRONG_NUMBER        // Invalid contact
  NOT_INTERESTED_NOW  // Not interested
}
